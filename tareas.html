<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mis tareas</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
</head>

<body>
    <section class="section">
        <div class="tabs is-toggle is-toggle-rounded is-fullwidth is-medium">
        <ul>
            <li class="is-active">
                <a href="inicio.html">
                    <span class="icon is-small"><i class="fas fa-house"></i></span>
                    <span>Inicio</span>
                </a>
            </li>

            <li>
                <a class="has-background-link-85 has-text-link-85-invert" href="usuarios.html">
                    <span class="icon is-small"><i class="fas fa-user"></i></span>
                    <span>Usuarios</span>
                </a>
            </li>

            <li>
                <a class="has-background-link-85 has-text-link-85-invert" href="grupos.html">
                    <span class="icon is-small"><i class="fas fa-user-group"></i></span>
                    <span>Grupos</span>
                </a>
            </li>
        </ul>
        </div>
    </section>
   
    <section class="section">
        <div class="columns is-mobile is-multiline is-centered">
            <div class="column is-narrow">
                <h1 class="title is-1 is-size-2-mobile has-text-primary">Mis tareas</h1>
            </div>
        </div>
        <div class="columns is-mobile is-multiline is-centered">
            <div class="column is-narrow">
                <a class="button has-background-link-85 has-text-link-85-invert is-rounded" href="agregar_tarea.html">
                    Agregar tarea
                </a>
            </div>
        </div>
    </section>

    <section class="section" id="tareas_pendientes">
        <table class="table is-bordered is-hoverable">
            <thead>
                <tr class="has-background-success-light">
                    <th>NÂ°</th>
                    <th>Nombre</th>
                    <th>Descripcion</th>
                    <th>Fecha de inicio</th>
                    <th>Fecha de finalizacion</th>
                    <th>Objetivos</th>
                </tr>
            </thead>
            <tbody id="info_tareas">
            </tbody>
        </table>
        <div class="field is-grouped pt-4">
            <div class="control">
                <a class="button is-warning" href="editar_tarea.html">Editar tarea</a>
            </div>
        </div>
    </section>
    <script src="https://kit.fontawesome.com/2c37e7fca6.js" crossorigin="anonymous"></script>
    <script>
        fetch('http://127.0.0.1:3000/api/v1/tareas')
        .then(response => response.json())
        .then(tarea => {
            let table = document.getElementById('info_tareas')
            table.innerHTML = ''
            tarea.forEach(element => {
                let id = document.createElement('th')
                id.textContent = element.id
                let nombre = document.createElement('td')
                nombre.textContent = element.nombre
                let descripcion = document.createElement('td')
                descripcion.textContent = element.descripcion
                let fecha_inicio = document.createElement('td')
                fecha_inicio.textContent = element.fecha_inicio
                let fecha_fin = document.createElement('td')
                fecha_fin.textContent = element.fecha_fin

                let borrar = document.createElement('td')
                let button = document.createElement('button')
                button.textContent = 'Eliminar'
                button.className = 'button is-danger is-small'
                button.onclick = function() { eliminarTarea(element.id) }
                borrar.appendChild(button)

                tr.appendChild(id)
                tr.appendChild(nombre)
                tr.appendChild(descripcion)
                tr.appendChild(fecha_inicio)
                tr.appendChild(fecha_fin)
                tr.appendChild(borrar)
                table.append(tr)
            });
        })

        eliminarTarea = function(id) {
            alert('Eliminando tarea ' + id)
            fetch('http://127.0.0.1:3000/api/v1/tareas/' + id, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(response => {
                let tr = document.getElementById('tarea-' + response.id)
                tr.remove()
            })
        }
    </script>
</body>